# 📘 Microsoft Agent Framework 학습 가이드

이 디렉토리는 **Microsoft Agent Framework** (GitHub: `microsoft/agent-framework`)를 사용한 예제 코드입니다.
이 프레임워크는 Semantic Kernel과 AutoGen의 장점을 결합하여 Python 및 .NET 환경에서 AI 에이전트와 멀티 에이전트 워크플로우를 구축하기 위한 통합 도구입니다.

## 📦 필수 요구사항

### 1. Python 패키지 설치
이 프레임워크는 현재 **Preview** 상태입니다. `--pre` 옵션을 사용하여 설치해야 합니다.

```bash
pip install agent-framework --pre
pip install azure-identity
```

### 2. Azure 리소스 준비
- **Azure OpenAI** 리소스 (Endpoint, Key)
- 모델 배포 (예: gpt-5.1)

### 3. 환경 변수 설정
`.env` 파일 또는 시스템 환경 변수에 다음 값을 설정하세요.

```env
OPEN_AI_ENDPOINT_5="https://<your-resource>.openai.azure.com/"
OPEN_AI_KEY_5="<your-api-key>"
AZURE_OPENAI_API_VERSION="2024-08-01-preview"
# 모델명은 코드 내에서 "gpt-5.1"로 고정되어 있습니다.
```

## 📂 예제 파일

| 순서 | 파일명                         | 내용                            | 주요 기능                                   |
| -- | --------------------------- | ----------------------------- | --------------------------------------- |
| 1  | 01_quickstart.py            | 기본 에이전트: Azure OpenAI로 하이쿠 작성 | AzureOpenAIResponsesClient,create_agent |
| 2  | 02_tool_usage.py            | 도구 사용: 계산기 함수 호출              | Tools, 함수 호출                            |
| 3  | 03_chat_loop.py             | 대화형 챗봇 루프                     | 상태 없는 연속 대화                             |
| 4  | 04_workflow.py              | Planner → Writer 순차 워크플로우     | Multi-agent sequencing                  |
| 5  | 05_streaming.py             | 스트리밍 응답 데모                    | stream=True, 토큰 단위 출력                   |
| 6  | 06_observability_tracing.py | OpenTelemetry 기반 추적           | Telemetry, ConsoleSpanExporter          |
| 7  | 07_supervisor_graph.py      | Supervisor + Sub-agent 그래프    | Workflow, Graph-style Orchestration     |

## 💡 주요 특징

- **Unified Foundation**: Semantic Kernel과 AutoGen의 개념을 통합.
- **Multi-Agent Orchestration**: 순차적, 계층적, 협업적 에이전트 패턴 지원.
- **Enterprise Grade**: 상태 관리, 타입 안정성, 관찰 가능성(Observability) 내장.

---
**참고**: 이 프레임워크는 개발 초기 단계이므로 API가 자주 변경될 수 있습니다. 최신 정보는 [공식 GitHub 저장소](https://github.com/microsoft/agent-framework)를 확인하세요.



“Microsoft Agent Framework”는 요즘 말하는 에이전트/코파일럿 스타일의 애플리케이션을 만들기 위한 설계 개념과 도구들의 묶음이라고 볼 수 있습니다.

1. 에이전트(Agent) 개념 자체
- 정의:
  - 사용자의 목표를 이해하고, 필요한 작업을 스스로 계획·실행하면서 결과를 돌려주는 “지능형 구성요소”.
  - 단순 챗봇이 아니라, “목표 지향적인 작업 수행자”에 가까움.
- 특징:
  - 사용자의 애매한 요청도 해석해서, 구체적인 액션으로 쪼개고 실행.
  - 여러 도구(검색, DB, API, 비즈니스 시스템 등)을 이용해 실제 일을 처리.
  - 대화를 통해 사용자의 의도를 계속 수정·보완하면서 결과를 개선.

2. 구성 요소의 큰 그림
Microsoft 기준 “에이전트 프레임워크”는 보통 다음과 같은 요소들을 조합해서 구현합니다.

- (1) 모델(Model)
  - GPT-4 같은 LLM이 중심.
  - 자연어 이해, 답변 생성, 계획(Planning), 코드/쿼리 생성 등 대부분의 “지능”을 담당.

- (2) 프롬프팅(Prompting) / 시스템 지침
  - 에이전트가 “어떤 역할을 하는지, 어떤 말투와 규칙을 따를지, 무엇을 할 수 있는지”를 정의한 규칙/지침 세트.
  - 예:
    - “너는 재무 분석을 도와주는 비서다.”
    - “SQL을 직접 건드리지 말고, 반드시 제공된 함수만 써라.”
  - 에이전트의 행동 범위·안전성·일관성을 유지하는 핵심.

- (3) 도구(Tools) / 기능(Functions) / 플러그인(Plugins)
  - 에이전트가 실제로 “손발처럼” 사용하는 외부 기능.
    - 예: 데이터베이스 조회, 사내 시스템 API 호출, 이메일 발송, 파일 읽기/쓰기, 웹 검색 등.
  - LLM이 “도구 호출”을 스스로 결정하고, 필요한 인자를 생성해서 호출.
  - 프레임워크는 이 도구들을 등록하고, 호출 결과를 다시 모델에게 전달하는 역할을 담당.

- (4) 계획(Planning)과 작업 분해(Task Decomposition)
  - 단순한 Q&A가 아니라, “목표 → 여러 단계 → 도구 호출 → 중간 결과 → 다음 단계”로 이어지는 복잡한 작업 수행을 가능하게 하는 개념.
  - 예:
    - “다음 주 팀 회의 일정 잡아줘”
      - 단계1: 관련 팀원 목록 가져오기 (도구 호출)
      - 단계2: 각 팀원의 캘린더 조회
      - 단계3: 공통 가능한 시간대 계산
      - 단계4: 가장 적합한 시간 선택 및 초대 메일 발송
  - 프레임워크 차원에서:
    - 한 번에 전체 계획을 세우는 방식(단일 플래너).
    - 매 단계마다 다시 생각하고 계획을 갱신하는 방식(점진적/반복적 플래닝).

- (5) 메모리(Memory)
  - 에이전트가 “이전 정보를 기억”하는 구조.
  - 보통 세 가지 층위로 나눠 생각합니다:
    - 단기 메모리: 현재 대화 세션의 맥락 (이전 질문/답변).
    - 중기/대화 히스토리: 여러 턴에 걸쳐 이어지는 맥락 요약.
    - 장기 메모리: 사용자 정보, 선호도, 과거 작업 기록, 도메인 지식(벡터 DB 등).
  - 메모리를 어떻게 저장·검색할지, 어떤 정보를 언제 꺼내 보여줄지 정의하는 것이 핵심.

- (6) 컨텍스트 관리(Context Orchestration)
  - 모델에 넘기는 프롬프트가 항상 길이 제한이 있기 때문에, 어떤 정보(대화 내용, 검색 결과, 사내 문서)를 포함할지 “선별·조합”하는 과정.
  - 예:
    - 지금 질문과 가장 관련 있는 문서를 벡터 검색으로 찾아서 상위 몇 개만 넣기.
    - 긴 대화 내용을 요약해서 맥락만 유지하기.
  - Framework는 이 “컨텍스트 구성”을 자동화/구조화합니다.

- (7) 오케스트레이션(Orchestration) / 컨트롤 플로우
  - 에이전트의 전체 동작 흐름:
    1) 사용자의 입력 수신
    2) 의도 분석 & 필요시 도구 호출 여부 판단
    3) 계획 수립 또는 단계적 실행
    4) 필요한 도구(또는 다른 에이전트) 호출
    5) 결과를 모델에 다시 전달하여 다음 행동 결정
    6) 최종 응답 생성
  - 이 일련의 과정을 조정·관리하는 “오케스트레이터” 역할이 프레임워크의 핵심입니다.
  - 다른 에이전트와의 협업(멀티 에이전트)도 이 레벨에서 조정.

3. 안전성과 정책(Guardrails, Safety, Governance)
- 에이전트는 실제 시스템·데이터에 접근하므로, 안전장치가 필수입니다.
- 주로 다음을 포함:
  - 콘텐츠 필터링: 유해/규정 위반 내용 생성 차단.
  - 권한/인증: 어떤 사용자에게 어떤 도구를 허용할지, 어떤 데이터에 접근 가능한지.
  - 정책 기반 제어:
    - 예: “회계 관련 API는 근무시간 내에만 호출”, “개인정보 조회는 로깅 필수”.
  - 감사/로그: 어떤 요청에 어떤 도구를 언제 어떻게 썼는지 기록.
- Microsoft 환경에서는 엔터프라이즈 보안/컴플라이언스 기준에 맞게 이 부분을 크게 강조합니다.

4. 상태(State)와 세션(Session) 관리
- 에이전트는 “상태를 가진 시스템”입니다.
  - 사용자의 현재 목표, 이미 수행한 단계, 도구 호출 결과, 중간 계획 등이 모두 상태.
- 세션 단위로:
  - 언제 세션을 시작/종료할지.
  - 세션이 끊겼다가 다시 이어질 때, 어느 정도까지 맥락을 복원할지.
  - 여러 장치(PC/모바일)에서 동일 사용자의 에이전트 경험을 어떻게 이어갈지.
- 프레임워크는 이런 상태를 저장/로드하고, 분산환경에서도 일관되게 유지하는 구조를 제공합니다.

5. 도메인 지식 통합(Knowledge Integration)
- 단순 인터넷 검색이 아니라, 회사 내부의 지식(문서, 위키, 데이터베이스 등)을 활용해야 진짜 “업무용 에이전트”가 됩니다.
- 핵심 개념:
  - RAG(Retrieval-Augmented Generation): 검색 + 생성 결합.
    - 질문 → 관련 문서/데이터 검색 → 검색 결과를 프롬프트에 넣고 답변 생성.
  - 인덱싱/벡터 스토어: 문서를 임베딩해서 유사도 검색 가능하게 만드는 과정.
  - 데이터 커넥터: SharePoint, OneDrive, SQL, CRM 등 외부 시스템 연결.
- 프레임워크는 이 검색·지식 통합 흐름을 표준화하고, 보안 정책과도 연계합니다.

6. 다중 에이전트(Multi-Agent) 및 역할 분리
- 복잡한 시스템에서는 하나의 거대한 에이전트보다, 역할이 분리된 여러 에이전트가 협업하는 구조가 더 효율적입니다.
  - 예:
    - “플래너(Planner) 에이전트” – 전체 계획 수립.
    - “리서처(Researcher) 에이전트” – 정보 수집/검색.
    - “실행(Executor) 에이전트” – 실제 API 호출·데이터 업데이트.
    - “리뷰어(Reviewer) 에이전트” – 결과 검증/품질 관리.
- 오케스트레이터는 이 에이전트들 간의 대화와 역할 분담을 조정합니다.

7. 확장성과 통합(Integration, Extensibility)
- Microsoft 관점의 프레임워크는 다음과의 통합을 전제로 설계됩니다.
  - 클라우드 서비스(Azure), 회사 내부 시스템, Microsoft 365(Outlook, Teams, SharePoint 등).
- 핵심 개념:
  - 표준 인터페이스: 에이전트에 새로운 도구/서비스를 붙일 때 동일한 패턴으로 확장.
  - 이벤트 기반 처리: 특정 이벤트(메일 도착, 티켓 생성 등)에 반응하는 에이전트.
  - 배포/운영: 어떤 환경에 배포할지, 스케일 아웃 어떻게 할지, 모니터링/로그 수집 등.

8. 관찰·로깅·모니터링(Observability)
- 실제 프로덕션 환경에서 중요한 개념:
  - 어떤 요청이 어떤 경로를 통해 처리됐는지 추적(Trace).
  - 도구 호출 횟수, 오류율, 응답 시간 모니터링.
  - 사용자 피드백(좋아요/싫어요, 수정 요청)을 수집해서 프롬프트/도구/정책 개선.
- 에이전트 프레임워크는 이 관찰 가능성을 구조적으로 지원해서, 운영과 개선을 용이하게 합니다.

9. 반복적 개선 루프(Feedback & Iteration)
- 에이전트는 “한 번 만들고 끝”이 아니라 계속 개선하는 시스템입니다.
  - 사용자 행동/피드백 → 로그 분석 → 프롬프트 수정, 도구 추가/제거, 정책 조정 → 다시 배포.
  - 어떤 유형의 질문에서 실패가 잦은지, 어떤 도구 사용이 비효율적인지 분석.
- 프레임워크 차원에서:
  - 실험/버전 관리(A/B 테스트 등).
  - 설정/프롬프트/정책의 버전 관리.

정리하면, Microsoft Agent Framework의 핵심 개념은 다음 한 줄로 요약할 수 있습니다.

- “대형 언어 모델 + 도구(시스템) + 지식 + 안전장치”를 하나의 일관된 구조로 엮어, 사용자의 목표를 대신 달성해주는 지능형 에이전트를 설계·구현·운영할 수 있게 해주는 설계 철학과 구성 요소들의 집합.

만약 다음 단계로,
- 실제로 어떻게 설계도(아키텍처)를 그릴지,
- 코드 레벨에서 어떤 구조(클래스, 인터페이스, 레이어)를 쓸지,
- 특정 시나리오(예: 헬프데스크, 세일즈, 사내 FAQ)에 맞는 에이전트 구조를 어떻게 짤지

같은 내용이 궁금하다면, 구체적인 시나리오를 알려주시면 그에 맞춰 더 자세한 예시까지 들어서 설명해 드릴게요.
